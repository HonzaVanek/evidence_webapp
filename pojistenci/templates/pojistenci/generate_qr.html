{% extends "base.html" %}
{% load static %}

{% block title %}Generování QR kódu{% endblock title %}

{% block style %}{% static "pojistenci/generate_qr.css" %}{% endblock style %}

{% block content %}

<h1 class="qr-title">Generování QR kódu</h1>
<p class="qr-subtitle">
    Zde je možné zadat jakýkoli text / link apod. a aplikace vygeneruje příslušný QR kód
</p>

<form id="qr-form" method="post" class="qr-form">
    {% csrf_token %}

    <label for="qr_text">Text nebo URL pro QR kód:</label>
    <input type="text" id="qr_text" name="qr_text" value="{{ data }}" required>

    <label for="qr_size">Velikost QR kódu (1-20):</label>
    <input type ="number" id="qr_size" name="qr_size" min="1" max="20" value="10" required>

    <label for="qr_border">Tloušťka okraje QR kódu (0-10):</label>
    <input type ="number" id="qr_border" name="qr_border" min="0" max="10" value="2" required>

    <label for="qr_color">Barva QR Kódu</label>
    <input type ="color" id="qr_color" name="qr_color" value="black" required>

    <label for="qr_background_color">Barva pozadí QR Kódu</label>
    <input type ="color" id="qr_background_color" name="qr_background_color" value="#ffffff" required>

    <input type="submit" value="Generovat QR kód" class="qr-submit">
</form>

{% if qr_image_url %}
    <div id="qr-result" class="qr-output">
        <h2>Vygenerovaný QR kód:</h2>
        <img id="qr-image" src="{{ qr_image_url }}" alt="QR kód">
    </div>


{% endif %}




<script>
// VLASTNÍ SMOOTH SCROLL S PLYNULÝM "EASE-IN-OUT"
function smoothScrollTo(endY, duration = 1400) {
    const startY = window.scrollY;
    const distance = endY - startY;
    let startTime = null;

    // Krásná, plynulá ease-in-out funkce
    function easeInOut(t) {
        return t < 0.5 
            ? 4 * t * t * t                    // pomalý rozjezd
            : 1 - Math.pow(-2 * t + 2, 3) / 2; // zpomalující dojezd
    }

    function step(timestamp) {
        if (!startTime) startTime = timestamp;
        const progress = timestamp - startTime;
        const percent = Math.min(progress / duration, 1);

        const eased = easeInOut(percent);

        window.scrollTo(0, startY + distance * eased);

        if (percent < 1) {
            requestAnimationFrame(step);
        }
    }

    requestAnimationFrame(step);
}

document.addEventListener("DOMContentLoaded", function () {

    const form = document.getElementById("qr-form");

    // 1) Při odeslání nastavíme flag
    if (form) {
        form.addEventListener("submit", function () {
            sessionStorage.setItem("qr_scroll_after_submit", "1");
        });
    }

    // 2) Po reloadu zkontrolujeme flag
    if (sessionStorage.getItem("qr_scroll_after_submit") === "1") {

        sessionStorage.removeItem("qr_scroll_after_submit");

        // počkáme 1 sekundu
        setTimeout(() => {
            const end = document.documentElement.scrollHeight;
            smoothScrollTo(end, 1400); // 1.4s animace
        }, 800);
    }
});
</script>




{% endblock content %}

