{% extends "base.html" %}
{% load static %}

{% block title %}Přidání nového pojištěnce{% endblock title %}

{% block style %}{% static "pojistenci/novy_pojistenec.css" %}{% endblock style %}

{% block content %}
<h1 class="nadpis">Formulář pro přidání nového pojištěnce</h1>
<p class="formular-bulk-upload">Zde můžete do databáze přidat nového pojištěnce. Administrátor může nahrát více pojištěnců najednou (bez fotky teda) importem Excelového souboru <a href="{% url 'bulk-upload-pojistenci' %}">zde</a></p>
<form method="post" enctype="multipart/form-data" class="formular">
    {% csrf_token %}

    {% if form.non_field_errors %}
        <div class="chyba">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="form-group">
        {{ form.first_name.label_tag }}
        {{ form.first_name }}
        {{ form.first_name.errors }}
    </div>

    <div class="form-group">
        {{ form.last_name.label_tag }}
        {{ form.last_name }}
        {{ form.last_name.errors }}
    </div>

    <div class="form-group">
        {{ form.address_street.label_tag }}
        {{ form.address_street }}
    </div>

    <div class="form-group">
        {{ form.address_city.label_tag }}
        {{ form.address_city }}
    </div>

    <div class="form-group">
        {{ form.psc.label_tag }}
        {{ form.psc }}
    </div>

    <div class="form-group">
        {{ form.phone.label_tag }}
        {{ form.phone }}
    </div>

    <div class="form-group">
        {{ form.email.label_tag }}
        {{ form.email }}
    </div>

    <div class="file-upload-wrapper">
        <label for="id_foto" class="custom-file-upload">
            Připojit fotografii
        </label>
        {{ form.foto }}
        <span id="file-name">Žádný soubor nevybrán</span>
        <div id="preview-wrapper" style="margin-top: 15px;">
            <img id="preview" src="#" alt="Náhled fotografie" style="display: none; max-width: 200px; height: auto; border-radius: 8px;">
        </div>
    </div>

    <button type="submit" class="btn submit-btn">Přidat pojištěnce</button>
</form>

<script>
    const fileInput = document.getElementById('id_foto');
    const fileName = document.getElementById('file-name');
    const preview = document.getElementById('preview');

    const allowedExtensions = ['jpg', 'jpeg', 'png'];
    const maxFileSizeMB = 3;  // maximální velikost v MB

    fileInput.addEventListener('change', function() {
        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            const extension = file.name.split('.').pop().toLowerCase();
            const fileSizeMB = file.size / (1024 * 1024);  // velikost v MB

            if (!allowedExtensions.includes(extension)) {
                alert('Nepovolený formát souboru! Povoleny jsou pouze JPG a PNG.');
                resetInput();
                return;
            }

            if (fileSizeMB > maxFileSizeMB) {
                alert(`Soubor je příliš velký! Maximální velikost je ${maxFileSizeMB} MB.`);
                resetInput();
                return;
            }

            fileName.textContent = file.name;

            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        } else {
            resetInput();
        }
    });

    function resetInput() {
        fileInput.value = '';
        fileName.textContent = 'Žádný soubor nevybrán';
        preview.src = '#';
        preview.style.display = 'none';
    }
</script>



{% endblock content %}